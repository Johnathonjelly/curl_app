Written for php class. I realize now this looks like hell. Valuable experience was gained writting this bad boy. 
